# Hardening
CONFIG_STACK_SENTINEL=n
CONFIG_HW_STACK_PROTECTION=y
CONFIG_MPU_STACK_GUARD=y

# External SPI Flash
CONFIG_NVS=y
CONFIG_SETTINGS_NVS=y
CONFIG_PM_EXTERNAL_FLASH_BASE=0x0
CONFIG_SPI_NOR=y
CONFIG_SPI_NOR_FLASH_LAYOUT_PAGE_SIZE=4096
CONFIG_PM_EXTERNAL_FLASH_MCUBOOT_SECONDARY=y
CONFIG_PM_OVERRIDE_EXTERNAL_DRIVER_CHECK=y

# Allow writing to the flash at runtime
CONFIG_MPU_ALLOW_FLASH_WRITE=y

# Neopixels over SPI
CONFIG_SPI=y
CONFIG_LED_STRIP=y

# NRF Modem configurations
CONFIG_NRF_MODEM_LIB=y
CONFIG_NRF_MODEM_LIB_FAULT_STRERROR=y
CONFIG_NRF_MODEM_LIB_ON_FAULT_APPLICATION_SPECIFIC=y
CONFIG_MODEM_KEY_MGMT=n

# Align the max FD entry to NRF_MODEM_MAX_SOCKET_COUNT(8)
CONFIG_ZVFS_OPEN_MAX=8
CONFIG_NET_SOCKETS_POLL_MAX=8

# Occasionally the TLS setup take a long time and we don't want to reset just for that
CONFIG_NET_SOCKETS_CONNECT_TIMEOUT=30000

# NRF LTE link control library
CONFIG_LTE_LINK_CONTROL=y

# LTE Power Saving Mode
CONFIG_LTE_LC_PSM_MODULE=y
CONFIG_LTE_PSM_REQ=y
# Request periodic TAU of 12 hours
CONFIG_LTE_PSM_REQ_RPTAU="00101100"
# Set Requested Active Time (RAT) to 10 seconds.
CONFIG_LTE_PSM_REQ_RAT="00000101"

# NRF net configurations
CONFIG_NET_NATIVE=n
CONFIG_NET_SOCKETS_OFFLOAD=y
CONFIG_NET_SOCKETS_SOCKOPT_TLS=y
# Disable Duplicate Address Detection (DAD), not properly implemented for offloaded interfaces
CONFIG_NET_IPV6_NBR_CACHE=n
CONFIG_NET_IPV6_MLD=n

# TF-M configurations
CONFIG_BUILD_WITH_TFM=y
CONFIG_TFM_PROFILE_TYPE_NOT_SET=y
CONFIG_TFM_CMAKE_BUILD_TYPE_RELEASE=y

# TF-M memory regions - optimize for size
CONFIG_PM_PARTITION_SIZE_TFM_SRAM=0x10000
CONFIG_PM_PARTITION_SIZE_TFM=0x37E00
CONFIG_PM_PARTITION_SIZE_TFM_PROTECTED_STORAGE=0x2000

# TF-M logging requirements
CONFIG_TFM_LOG_LEVEL_SILENCE=y
CONFIG_TFM_PROFILE_TYPE_NOT_SET=y
CONFIG_TFM_EXCEPTION_INFO_DUMP=n

# Crypto drivers
CONFIG_NRF_SECURITY=y
CONFIG_MBEDTLS_LEGACY_CRYPTO_C=y
CONFIG_PSA_CRYPTO_DRIVER_CC3XX=y

# Enable MbedTLS
CONFIG_MBEDTLS=y

# MbedTLS configurations
CONFIG_MBEDTLS_ENABLE_HEAP=y
## Heap size needs to be at least SSL_IN_CONTENT_LEN + SSL_OUT_CONTENT_LEN + 32768 for HTTPS
CONFIG_MBEDTLS_HEAP_SIZE=65536
CONFIG_MBEDTLS_SSL_IN_CONTENT_LEN=16384
CONFIG_MBEDTLS_SSL_OUT_CONTENT_LEN=16384

# MbedTLS net configurations
CONFIG_NET_SOCKETS_TLS_MAX_CONTEXTS=6
CONFIG_TLS_MAX_CREDENTIALS_NUMBER=8
CONFIG_NET_SOCKETS_TLS_MAX_CREDENTIALS=8

# Create the mbed SSL/TLS library in addition to the mbed crypto library
CONFIG_MBEDTLS_TLS_LIBRARY=y

# mbedtls X509 configurations
CONFIG_MBEDTLS_X509_LIBRARY=y

# Enable TLS credentials management subsystem
CONFIG_TLS_CREDENTIALS=y
CONFIG_TLS_CREDENTIALS_BACKEND_PROTECTED_STORAGE=y

# MbedTLS module configurations
CONFIG_MBEDTLS_PSA_CRYPTO_C=y
CONFIG_MBEDTLS_X509_LIBRARY=y
CONFIG_MBEDTLS_PK_C=y
CONFIG_MBEDTLS_PK_PARSE_C=y
CONFIG_MBEDTLS_PK_PARSE_EC_EXTENDED=y
CONFIG_MBEDTLS_AES_C=y
CONFIG_MBEDTLS_ECDH_C=y
CONFIG_MBEDTLS_ECDSA_C=y
CONFIG_MBEDTLS_CIPHER_C=y
CONFIG_MBEDTLS_SHA256_C=y

CONFIG_MBEDTLS_SSL_SRV_C=n
CONFIG_MBEDTLS_TLS_VERSION_1_2=n
CONFIG_MBEDTLS_CIPHER=n
CONFIG_MBEDTLS_ECJPAKE_C=n
CONFIG_MBEDTLS_SHA1_C=n
CONFIG_MBEDTLS_SHA224_C=n
CONFIG_MBEDTLS_SHA384_C=n
CONFIG_MBEDTLS_SHA512_C=n
CONFIG_MBEDTLS_CHACHA20_C=n
CONFIG_MBEDTLS_POLY1305_C=n
CONFIG_MBEDTLS_CHACHAPOLY_C=n
CONFIG_MBEDTLS_CCM_C=n
CONFIG_MBEDTLS_HKDF_C=n
CONFIG_MBEDTLS_HMAC_DRBG_C=n
CONFIG_MBEDTLS_ECDSA_DETERMINISTIC=n
CONFIG_MBEDTLS_DHM_C=n
CONFIG_MBEDTLS_CIPHER_MODE_CBC=n
CONFIG_MBEDTLS_CIPHER_PADDING_PKCS7=n
CONFIG_MBEDTLS_CIPHER_PADDING_ONE_AND_ZEROS=n
CONFIG_MBEDTLS_CIPHER_PADDING_ZEROS_AND_LEN=n
CONFIG_MBEDTLS_CIPHER_PADDING_ZEROS=n
CONFIG_MBEDTLS_MAC_SHA256_ENABLED=n
CONFIG_MBEDTLS_CMAC_C=n
CONFIG_MBEDTLS_CIPHER_MODE_CTR=n
CONFIG_MBEDTLS_ECP_DP_SECP256R1_ENABLED=n

# Key exchange configurations
CONFIG_MBEDTLS_KEY_EXCHANGE_ECDH_ECDSA_ENABLED=y
CONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_ECDSA_ENABLED=y

CONFIG_MBEDTLS_KEY_EXCHANGE_PSK_ENABLED=n
CONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_PSK_ENABLED=n

# Key type configurations
CONFIG_PSA_WANT_KEY_TYPE_AES=y
CONFIG_PSA_WANT_KEY_TYPE_ECC_PUBLIC_KEY=y
CONFIG_PSA_WANT_KEY_TYPE_ECC_KEY_PAIR_IMPORT=y
CONFIG_PSA_WANT_KEY_TYPE_ECC_KEY_PAIR_EXPORT=y
CONFIG_PSA_WANT_KEY_TYPE_ECC_KEY_PAIR_DERIVE=y
CONFIG_PSA_WANT_KEY_TYPE_ECC_KEY_PAIR_GENERATE=y

# Cipher configurations
CONFIG_PSA_WANT_ALG_CTR=y
CONFIG_PSA_WANT_ALG_STREAM_CIPHER=y

CONFIG_PSA_WANT_ALG_CBC_NO_PADDING=n

# Key agreement configurations
CONFIG_PSA_WANT_ALG_ECDH=y

# Key derivation function configurations
CONFIG_PSA_WANT_ALG_TLS12_PRF=n
CONFIG_PSA_WANT_ALG_TLS12_PSK_TO_MS=n

# MAC configurations
CONFIG_PSA_WANT_ALG_HMAC=y

# AEAD configurations
CONFIG_PSA_WANT_ALG_GCM=y

# Asymmetric signature configurations
CONFIG_PSA_WANT_ALG_ECDSA=y
CONFIG_PSA_WANT_ALG_SHA_256=y

# ECC curve configurations
CONFIG_PSA_WANT_ECC_SECP_R1_256=y

# RNG configurations
CONFIG_PSA_WANT_ALG_CTR_DRBG=y

# Enable SNI
CONFIG_MBEDTLS_X509_CRT_PARSE_C=y
CONFIG_MBEDTLS_SSL_SERVER_NAME_INDICATION=y

# Enable SSL renegotiation
CONFIG_MBEDTLS_SSL_RENEGOTIATION=y

# Enable SSL session tickets
CONFIG_MBEDTLS_SSL_SESSION_TICKETS=y
